<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control de Vencimientos</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007bff">

<style>
:root{--bg:#eef2f6;--card:#fff;--text:#000}
body.dark{--bg:#121212;--card:#1e1e1e;--text:#fff}
body{margin:0;font-family:Arial;background:var(--bg);color:var(--text);padding-top:70px}
.hidden{display:none}

header{
 position:fixed;top:0;left:0;right:0;
 background:#007bff;color:#fff;
 padding:15px;display:flex;
 justify-content:space-between;z-index:1000
}

.box,.card{
 background:var(--card);padding:12px;
 border-radius:12px;margin:10px;
 box-shadow:0 4px 8px rgba(0,0,0,.1)
}

input,button,select{
 width:100%;padding:10px;margin:5px 0;
 border-radius:8px;border:1px solid #ccc
}
button{background:#007bff;color:#fff;border:none}

.vencido{border-left:6px solid red}
.porvencer{border-left:6px solid orange}
.activo{border-left:6px solid green}

.tag{padding:2px 8px;border-radius:6px;font-size:12px;color:#fff}
.netflix{background:#e50914}
.spotify{background:#1db954}
.iptv{background:#6f42c1}

.fab{
 position:fixed;bottom:20px;right:20px;
 width:60px;height:60px;border-radius:50%;
 background:#007bff;color:#fff;font-size:30px;
 display:flex;align-items:center;justify-content:center
}
</style>
</head>

<body>

<header>
 <b>ğŸ“… Vencimientos</b>
 <button onclick="toggleDark()">ğŸŒ™</button>
</header>

<div id="loginBox" class="box">
 <h2>ğŸ” Ingreso</h2>
 <input type="password" id="passwordInput" placeholder="ContraseÃ±a">
 <button onclick="login()">Entrar</button>
</div>

<div id="app" class="hidden">

<div class="box"><b id="stats"></b></div>

<div id="formBox" class="box hidden">
 <input id="cliente" placeholder="Cliente">
 <input id="telefono" placeholder="TelÃ©fono (54911...)">
 <input id="servicio" placeholder="Servicio">
 <select id="tag">
  <option value="">Etiqueta</option>
  <option value="netflix">Netflix</option>
  <option value="spotify">Spotify</option>
  <option value="iptv">IPTV</option>
 </select>
 <input id="fecha" type="date">
 <input id="dias" type="number" placeholder="DuraciÃ³n (dÃ­as)">
 <input id="ganancia" type="number" placeholder="Ganancia">
 <button onclick="guardar()">Guardar</button>
</div>

<div id="lista"></div>

<h3 style="margin:10px">ğŸ“† Calendario</h3>
<div id="calendarioBox" class="box"></div>

</div>

<div class="fab" onclick="toggleForm()">+</div>

<script>
const CLAVE="0546";
let datos = JSON.parse(localStorage.getItem("clientes")) || [];

/* =====================
   FECHAS SIN ZONA HORARIA
   ===================== */
function sumarDias(fecha, dias){
 let [y,m,d] = fecha.split("-").map(Number);
 let f = new Date(y, m-1, d + dias);
 return f.getFullYear()+"-"+String(f.getMonth()+1).padStart(2,"0")+"-"+String(f.getDate()).padStart(2,"0");
}

function diasEntre(fecha){
 let [y,m,d] = fecha.split("-").map(Number);
 let hoy = new Date();
 let f = new Date(y, m-1, d);
 let h = new Date(hoy.getFullYear(), hoy.getMonth(), hoy.getDate());
 return Math.floor((f - h) / 86400000);
}

function login(){
 if(passwordInput.value===CLAVE){
  localStorage.setItem("login_ok","1");
  iniciar();
 }else alert("ContraseÃ±a incorrecta");
}

function iniciar(){
 loginBox.classList.add("hidden");
 app.classList.remove("hidden");
 mostrar();
 renderCalendario();
}
if(localStorage.getItem("login_ok")==="1") iniciar();

function guardar(){
 if(!cliente.value || !servicio.value || !fecha.value || !dias.value){
  alert("CompletÃ¡ todos los campos obligatorios");
  return;
 }

 let vencimiento = sumarDias(fecha.value, parseInt(dias.value));

 datos.push({
  c: cliente.value,
  t: telefono.value,
  s: servicio.value,
  v: vencimiento,
  g: +ganancia.value || 0,
  d: +dias.value,
  tag: tag.value
 });

 localStorage.setItem("clientes", JSON.stringify(datos));
 formBox.classList.add("hidden");
 mostrar();
 renderCalendario();
}

function renovar(i){
 datos[i].v = sumarDias(datos[i].v, datos[i].d);
 localStorage.setItem("clientes", JSON.stringify(datos));
 mostrar();
 renderCalendario();
}

function eliminar(i){
 if(!confirm("Â¿Eliminar cliente?"))return;
 datos.splice(i,1);
 localStorage.setItem("clientes",JSON.stringify(datos));
 mostrar();
 renderCalendario();
}

function enviarWhatsApp(i){
 let d = datos[i];
 let msg = `Hola ${d.c} ğŸ‘‹\nTu servicio *${d.s}* vence el *${d.v.split("-").reverse().join("/")}*`;
 window.open(`https://wa.me/${d.t}?text=${encodeURIComponent(msg)}`,"_blank");
}

function mostrar(){
 lista.innerHTML="";
 let activos=0,vencidos=0,total=0;

 datos.forEach((d,i)=>{
  let diff = diasEntre(d.v);
  let cl = diff<=0 ? "vencido" : diff<=5 ? "porvencer" : "activo";
  if(diff<=0)vencidos++; else activos++;
  total += d.g;

  lista.innerHTML+=`
  <div class="card ${cl}">
   <b>${d.c}</b> ${d.tag?`<span class="tag ${d.tag}">${d.tag}</span>`:""}<br>
   ğŸ“ ${d.t}<br>
   ${d.s}<br>
   ğŸ“… ${d.v.split("-").reverse().join("/")}<br>
   ğŸ’° $${d.g}<br>
   <button onclick="renovar(${i})">ğŸ” Renovar</button>
   <button onclick="enviarWhatsApp(${i})">ğŸ“² WhatsApp</button>
   <button onclick="eliminar(${i})" style="background:#dc3545">ğŸ—‘</button>
  </div>`;
 });

 stats.innerText=`Clientes: ${datos.length} | Activos: ${activos} | Vencidos: ${vencidos} | Total: $${total}`;
}

function renderCalendario(){
 calendarioBox.innerHTML="";
 [...datos]
 .sort((a,b)=>a.v.localeCompare(b.v))
 .forEach(d=>{
  calendarioBox.innerHTML+=`ğŸ“… ${d.v.split("-").reverse().join("/")} â€“ <b>${d.c}</b><br>`;
 });
}

function toggleForm(){formBox.classList.toggle("hidden")}
function toggleDark(){
 document.body.classList.toggle("dark");
 localStorage.setItem("dark",document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true")document.body.classList.add("dark");

/* PWA */
if("serviceWorker" in navigator){
 navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
