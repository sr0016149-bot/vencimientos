<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control de Vencimientos</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #eef2f6;
    padding: 15px;
}
h1 {
    text-align: center;
}
.top {
    background: white;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
}
input, button {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
}
button {
    background: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
}
.stats {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}
.stat {
    flex: 1;
    background: #fff;
    padding: 10px;
    border-radius: 8px;
    text-align: center;
}
.card {
    background: white;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 10px;
}
.vencido { border-left: 6px solid red; }
.porvencer { border-left: 6px solid orange; }
.activo { border-left: 6px solid green; }
.whatsapp {
    background: #25d366;
    margin-top: 5px;
}
.delete {
    background: #dc3545;
    margin-top: 5px;
}
</style>
</head>

<body>

<h1>ðŸ“… Control de Vencimientos</h1>

<div class="top">
    <div class="stats">
        <div class="stat" id="sVencidos">Vencidos: 0</div>
        <div class="stat" id="sPorVencer">Por vencer: 0</div>
        <div class="stat" id="sActivos">Activos: 0</div>
        <div class="stat" id="sGanancia">Ganancia: $0</div>
    </div>
</div>

<div class="top">
    <input id="buscar" placeholder="Buscar cliente o servicio" onkeyup="mostrar()">

    <input id="cliente" placeholder="Cliente">
    <input id="telefono" placeholder="WhatsApp (549...)">
    <input id="servicio" placeholder="Servicio">
    <input id="fecha" type="date">
    <input id="dias" type="number" placeholder="DuraciÃ³n en dÃ­as">
    <input id="precio" type="number" placeholder="Precio">
    <input id="ganancia" type="number" placeholder="Ganancia">

    <button onclick="guardar()">Guardar cliente</button>
</div>

<div id="lista"></div>

<script>
let datos = JSON.parse(localStorage.getItem("clientes")) || [];

function guardar() {
    const c = cliente.value;
    const t = telefono.value;
    const s = servicio.value;
    const f = fecha.value;
    const d = parseInt(dias.value);
    const p = parseFloat(precio.value);
    const g = parseFloat(ganancia.value);

    if (!c || !s || !f || !d) {
        alert("CompletÃ¡ los campos obligatorios");
        return;
    }

    const ini = new Date(f);
    const ven = new Date(ini);
    ven.setDate(ini.getDate() + d);

    datos.push({c,t,s,ven: ven.toISOString(),p,g});
    localStorage.setItem("clientes", JSON.stringify(datos));

    cliente.value = telefono.value = servicio.value = "";
    fecha.value = dias.value = precio.value = ganancia.value = "";

    mostrar();
}

function mostrar() {
    const hoy = new Date();
    const b = buscar.value.toLowerCase();
    let v=0,pv=0,a=0,gan=0;
    lista.innerHTML = "";

    datos.forEach((d,i)=>{
        if (!d.c.toLowerCase().includes(b) && !d.s.toLowerCase().includes(b)) return;

        const ven = new Date(d.ven);
        const diff = Math.ceil((ven-hoy)/(1000*60*60*24));
        let cl="activo";
        if (diff<=0){cl="vencido";v++}
        else if(diff<=5){cl="porvencer";pv++}
        else{a++}

        gan += d.g || 0;

        lista.innerHTML += `
        <div class="card ${cl}">
            <b>${d.c}</b><br>
            ${d.s}<br>
            Vence: ${ven.toLocaleDateString()}<br>
            Precio: $${d.p || 0} | Ganancia: $${d.g || 0}<br>
            ${d.t ? `<a href="https://wa.me/${d.t}" target="_blank">
            <button class="whatsapp">WhatsApp</button></a>` : ""}
            <button class="delete" onclick="borrar(${i})">Eliminar</button>
        </div>`;
    });

    sVencidos.innerText = "Vencidos: " + v;
    sPorVencer.innerText = "Por vencer: " + pv;
    sActivos.innerText = "Activos: " + a;
    sGanancia.innerText = "Ganancia: $" + gan;
}

function borrar(i){
    datos.splice(i,1);
    localStorage.setItem("clientes", JSON.stringify(datos));
    mostrar();
}

mostrar();
</script>

</body>
</html>
