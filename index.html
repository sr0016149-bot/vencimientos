<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control de Vencimientos</title>

<style>
body {font-family: Arial; background:#eef2f6; padding:15px;}
h1{text-align:center;}
.box{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px;}
input,button{width:100%;padding:10px;margin:5px 0;}
button{background:#007bff;color:#fff;border:none;border-radius:6px;}
.stats{display:flex;gap:10px;flex-wrap:wrap;}
.stat{flex:1;background:#fff;padding:10px;border-radius:8px;text-align:center;}
.card{background:#fff;padding:12px;border-radius:10px;margin-bottom:10px;}
.vencido{border-left:6px solid red;}
.porvencer{border-left:6px solid orange;}
.activo{border-left:6px solid green;}
.whatsapp{background:#25d366;}
.delete{background:#dc3545;}
</style>
</head>

<body>

<h1>ðŸ“… Control de Vencimientos</h1>

<div class="stats">
  <div class="stat" id="vencidos">Vencidos: 0</div>
  <div class="stat" id="porvencer">Por vencer: 0</div>
  <div class="stat" id="activos">Activos: 0</div>
  <div class="stat" id="gananciaTotal">Ganancia: $0</div>
</div>

<div class="box">
  <input id="buscar" placeholder="Buscar cliente o servicio" onkeyup="mostrar()">
  <input id="cliente" placeholder="Cliente">
  <input id="telefono" placeholder="WhatsApp (549...)">
  <input id="servicio" placeholder="Servicio">
  <input id="fecha" type="date">
  <input id="dias" type="number" placeholder="DuraciÃ³n en dÃ­as">
  <input id="precio" type="number" placeholder="Precio">
  <input id="ganancia" type="number" placeholder="Ganancia">
  <button onclick="guardar()">Guardar</button>
</div>

<div id="lista"></div>

<script>
let datos = JSON.parse(localStorage.getItem("clientes")) || [];

function guardar(){
  const c = document.getElementById("cliente").value;
  const t = document.getElementById("telefono").value;
  const s = document.getElementById("servicio").value;
  const f = document.getElementById("fecha").value;
  const d = parseInt(document.getElementById("dias").value);
  const p = parseFloat(document.getElementById("precio").value) || 0;
  const g = parseFloat(document.getElementById("ganancia").value) || 0;

  if(!c || !s || !f || !d){
    alert("CompletÃ¡ los campos obligatorios");
    return;
  }

  const ini = new Date(f);
  const ven = new Date(ini);
  ven.setDate(ini.getDate() + d);

  datos.push({c,t,s,ven:ven.toISOString(),p,g});
  localStorage.setItem("clientes", JSON.stringify(datos));

  document.querySelectorAll("input").forEach(i=>i.value="");
  mostrar();
}

function mostrar(){
  const hoy = new Date();
  const b = document.getElementById("buscar").value.toLowerCase();
  let v=0,pv=0,a=0,gt=0;
  document.getElementById("lista").innerHTML="";

  datos.forEach((d,i)=>{
    if(!d.c.toLowerCase().includes(b) && !d.s.toLowerCase().includes(b)) return;

    const ven = new Date(d.ven);
    const diff = Math.ceil((ven-hoy)/(1000*60*60*24));
    let cl="activo";
    if(diff<=0){cl="vencido";v++}
    else if(diff<=5){cl="porvencer";pv++}
    else{a++}

    gt += d.g;

    lista.innerHTML+=`
    <div class="card ${cl}">
      <b>${d.c}</b><br>
      ${d.s}<br>
      Vence: ${ven.toLocaleDateString()}<br>
      Precio: $${d.p} | Ganancia: $${d.g}<br>
      ${d.t?`<a href="https://wa.me/${d.t}" target="_blank">
      <button class="whatsapp">WhatsApp</button></a>`:""}
      <button class="delete" onclick="borrar(${i})">Eliminar</button>
    </div>`;
  });

  vencidos.innerText="Vencidos: "+v;
  porvencer.innerText="Por vencer: "+pv;
  activos.innerText="Activos: "+a;
  gananciaTotal.innerText="Ganancia: $"+gt;
}

function borrar(i){
  datos.splice(i,1);
  localStorage.setItem("clientes", JSON.stringify(datos));
  mostrar();
}

mostrar();
</script>

</body>
</html>
